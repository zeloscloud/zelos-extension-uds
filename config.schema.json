{
  "$comment": "This schema defines the configuration UI in Zelos App. See https://docs.zeloscloud.io/sdk/how-to/develop-extensions/#configuration for full widget reference.",
  "type": "object",
  "title": "UDS Diagnostic Client Configuration",
  "description": "Configure UDS diagnostic services over CAN with ISO-TP transport",
  "properties": {
    "interface": {
      "type": "string",
      "title": "CAN Interface",
      "description": "CAN interface type (e.g. Linux: socketcan, macOS/Windows: pcan)",
      "enum": [
        "socketcan",
        "pcan",
        "kvaser",
        "vector",
        "other"
      ]
    }
  },
  "required": [
    "interface"
  ],
  "dependencies": {
    "interface": {
      "oneOf": [
        {
          "properties": {
            "interface": {
              "enum": [
                "socketcan"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "can0"
            },
            "tx_id": {
              "type": "string",
              "title": "TX CAN ID (hex)",
              "description": "CAN ID for outgoing requests (tester->ECU)",
              "default": "0x7E0",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E0",
              "ui:help": "Standard: 0x7DF (broadcast), 0x7E0-0x7E7 (physical)"
            },
            "rx_id": {
              "type": "string",
              "title": "RX CAN ID (hex)",
              "description": "CAN ID for incoming responses (ECU->tester)",
              "default": "0x7E8",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E8",
              "ui:help": "Standard: 0x7E8-0x7EF (ECU responses)"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR"
              ],
              "default": "INFO"
            },
            "show_advanced": {
              "type": "boolean",
              "title": "Show Advanced Settings",
              "description": "Show advanced timeout and protocol settings",
              "default": false,
              "ui:widget": "toggle"
            }
          },
          "required": [
            "channel"
          ],
          "dependencies": {
            "show_advanced": {
              "oneOf": [
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        true
                      ]
                    },
                    "request_timeout": {
                      "type": "number",
                      "title": "Request Timeout (seconds)",
                      "description": "Maximum time to wait for UDS response",
                      "minimum": 0.1,
                      "maximum": 30.0,
                      "default": 5.0,
                      "ui:help": "Total timeout for complete request/response cycle"
                    },
                    "p2_timeout": {
                      "type": "number",
                      "title": "P2 Timeout (seconds)",
                      "description": "Default P2 timeout per ISO 14229",
                      "minimum": 0.05,
                      "maximum": 5.0,
                      "default": 1.0,
                      "ui:help": "Time for ECU to start sending response"
                    },
                    "p2_star_timeout": {
                      "type": "number",
                      "title": "P2* Enhanced Timeout (seconds)",
                      "description": "Enhanced P2 timeout for long operations",
                      "minimum": 1.0,
                      "maximum": 60.0,
                      "default": 5.0,
                      "ui:help": "Extended timeout for flash/programming operations"
                    },
                    "config_json": {
                      "type": "string",
                      "title": "Advanced Configuration (JSON)",
                      "description": "Additional python-can Bus() kwargs as JSON object",
                      "ui:help": "Example: {\"fd\": true, \"data_bitrate\": 2000000}"
                    }
                  }
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "pcan"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "PCAN_USBBUS1"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "tx_id": {
              "type": "string",
              "title": "TX CAN ID (hex)",
              "description": "CAN ID for outgoing requests (tester->ECU)",
              "default": "0x7E0",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E0",
              "ui:help": "Standard: 0x7DF (broadcast), 0x7E0-0x7E7 (physical)"
            },
            "rx_id": {
              "type": "string",
              "title": "RX CAN ID (hex)",
              "description": "CAN ID for incoming responses (ECU->tester)",
              "default": "0x7E8",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E8",
              "ui:help": "Standard: 0x7E8-0x7EF (ECU responses)"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR"
              ],
              "default": "INFO"
            },
            "show_advanced": {
              "type": "boolean",
              "title": "Show Advanced Settings",
              "description": "Show advanced timeout and protocol settings",
              "default": false,
              "ui:widget": "toggle"
            }
          },
          "required": [
            "channel",
            "bitrate"
          ],
          "dependencies": {
            "show_advanced": {
              "oneOf": [
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        true
                      ]
                    },
                    "request_timeout": {
                      "type": "number",
                      "title": "Request Timeout (seconds)",
                      "description": "Maximum time to wait for UDS response",
                      "minimum": 0.1,
                      "maximum": 30.0,
                      "default": 5.0,
                      "ui:help": "Total timeout for complete request/response cycle"
                    },
                    "p2_timeout": {
                      "type": "number",
                      "title": "P2 Timeout (seconds)",
                      "description": "Default P2 timeout per ISO 14229",
                      "minimum": 0.05,
                      "maximum": 5.0,
                      "default": 1.0,
                      "ui:help": "Time for ECU to start sending response"
                    },
                    "p2_star_timeout": {
                      "type": "number",
                      "title": "P2* Enhanced Timeout (seconds)",
                      "description": "Enhanced P2 timeout for long operations",
                      "minimum": 1.0,
                      "maximum": 60.0,
                      "default": 5.0,
                      "ui:help": "Extended timeout for flash/programming operations"
                    },
                    "config_json": {
                      "type": "string",
                      "title": "Advanced Configuration (JSON)",
                      "description": "Additional python-can Bus() kwargs as JSON object",
                      "ui:help": "Example: {\"fd\": true, \"data_bitrate\": 2000000}"
                    }
                  }
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "kvaser"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "0"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "tx_id": {
              "type": "string",
              "title": "TX CAN ID (hex)",
              "description": "CAN ID for outgoing requests (tester->ECU)",
              "default": "0x7E0",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E0",
              "ui:help": "Standard: 0x7DF (broadcast), 0x7E0-0x7E7 (physical)"
            },
            "rx_id": {
              "type": "string",
              "title": "RX CAN ID (hex)",
              "description": "CAN ID for incoming responses (ECU->tester)",
              "default": "0x7E8",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E8",
              "ui:help": "Standard: 0x7E8-0x7EF (ECU responses)"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR"
              ],
              "default": "INFO"
            },
            "show_advanced": {
              "type": "boolean",
              "title": "Show Advanced Settings",
              "description": "Show advanced timeout and protocol settings",
              "default": false,
              "ui:widget": "toggle"
            }
          },
          "required": [
            "channel",
            "bitrate"
          ],
          "dependencies": {
            "show_advanced": {
              "oneOf": [
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        true
                      ]
                    },
                    "request_timeout": {
                      "type": "number",
                      "title": "Request Timeout (seconds)",
                      "description": "Maximum time to wait for UDS response",
                      "minimum": 0.1,
                      "maximum": 30.0,
                      "default": 5.0,
                      "ui:help": "Total timeout for complete request/response cycle"
                    },
                    "p2_timeout": {
                      "type": "number",
                      "title": "P2 Timeout (seconds)",
                      "description": "Default P2 timeout per ISO 14229",
                      "minimum": 0.05,
                      "maximum": 5.0,
                      "default": 1.0,
                      "ui:help": "Time for ECU to start sending response"
                    },
                    "p2_star_timeout": {
                      "type": "number",
                      "title": "P2* Enhanced Timeout (seconds)",
                      "description": "Enhanced P2 timeout for long operations",
                      "minimum": 1.0,
                      "maximum": 60.0,
                      "default": 5.0,
                      "ui:help": "Extended timeout for flash/programming operations"
                    },
                    "config_json": {
                      "type": "string",
                      "title": "Advanced Configuration (JSON)",
                      "description": "Additional python-can Bus() kwargs as JSON object",
                      "ui:help": "Example: {\"fd\": true, \"data_bitrate\": 2000000}"
                    }
                  }
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "vector"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "0"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "tx_id": {
              "type": "string",
              "title": "TX CAN ID (hex)",
              "description": "CAN ID for outgoing requests (tester->ECU)",
              "default": "0x7E0",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E0",
              "ui:help": "Standard: 0x7DF (broadcast), 0x7E0-0x7E7 (physical)"
            },
            "rx_id": {
              "type": "string",
              "title": "RX CAN ID (hex)",
              "description": "CAN ID for incoming responses (ECU->tester)",
              "default": "0x7E8",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E8",
              "ui:help": "Standard: 0x7E8-0x7EF (ECU responses)"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR"
              ],
              "default": "INFO"
            },
            "show_advanced": {
              "type": "boolean",
              "title": "Show Advanced Settings",
              "description": "Show advanced timeout and protocol settings",
              "default": false,
              "ui:widget": "toggle"
            }
          },
          "required": [
            "channel",
            "bitrate"
          ],
          "dependencies": {
            "show_advanced": {
              "oneOf": [
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        true
                      ]
                    },
                    "request_timeout": {
                      "type": "number",
                      "title": "Request Timeout (seconds)",
                      "description": "Maximum time to wait for UDS response",
                      "minimum": 0.1,
                      "maximum": 30.0,
                      "default": 5.0,
                      "ui:help": "Total timeout for complete request/response cycle"
                    },
                    "p2_timeout": {
                      "type": "number",
                      "title": "P2 Timeout (seconds)",
                      "description": "Default P2 timeout per ISO 14229",
                      "minimum": 0.05,
                      "maximum": 5.0,
                      "default": 1.0,
                      "ui:help": "Time for ECU to start sending response"
                    },
                    "p2_star_timeout": {
                      "type": "number",
                      "title": "P2* Enhanced Timeout (seconds)",
                      "description": "Enhanced P2 timeout for long operations",
                      "minimum": 1.0,
                      "maximum": 60.0,
                      "default": 5.0,
                      "ui:help": "Extended timeout for flash/programming operations"
                    },
                    "config_json": {
                      "type": "string",
                      "title": "Advanced Configuration (JSON)",
                      "description": "Additional python-can Bus() kwargs as JSON object",
                      "ui:help": "Example: {\"fd\": true, \"data_bitrate\": 2000000}"
                    }
                  }
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "other"
              ]
            },
            "tx_id": {
              "type": "string",
              "title": "TX CAN ID (hex)",
              "description": "CAN ID for outgoing requests (tester->ECU)",
              "default": "0x7E0",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E0",
              "ui:help": "Standard: 0x7DF (broadcast), 0x7E0-0x7E7 (physical)"
            },
            "rx_id": {
              "type": "string",
              "title": "RX CAN ID (hex)",
              "description": "CAN ID for incoming responses (ECU->tester)",
              "default": "0x7E8",
              "pattern": "^0x[0-9A-Fa-f]{1,3}$",
              "ui:placeholder": "0x7E8",
              "ui:help": "Standard: 0x7E8-0x7EF (ECU responses)"
            },
            "config_json": {
              "type": "string",
              "title": "CAN Configuration (JSON)",
              "description": "Complete python-can Bus() kwargs as JSON. Must include 'interface' and 'channel' keys.",
              "ui:help": "Example: {\"interface\": \"slcan\", \"channel\": \"/dev/ttyUSB0\", \"bitrate\": 500000}"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR"
              ],
              "default": "INFO"
            },
            "show_advanced": {
              "type": "boolean",
              "title": "Show Advanced Settings",
              "description": "Show advanced timeout and protocol settings",
              "default": false,
              "ui:widget": "toggle"
            }
          },
          "required": [
            "config_json"
          ],
          "dependencies": {
            "show_advanced": {
              "oneOf": [
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "show_advanced": {
                      "enum": [
                        true
                      ]
                    },
                    "request_timeout": {
                      "type": "number",
                      "title": "Request Timeout (seconds)",
                      "description": "Maximum time to wait for UDS response",
                      "minimum": 0.1,
                      "maximum": 30.0,
                      "default": 5.0,
                      "ui:help": "Total timeout for complete request/response cycle"
                    },
                    "p2_timeout": {
                      "type": "number",
                      "title": "P2 Timeout (seconds)",
                      "description": "Default P2 timeout per ISO 14229",
                      "minimum": 0.05,
                      "maximum": 5.0,
                      "default": 1.0,
                      "ui:help": "Time for ECU to start sending response"
                    },
                    "p2_star_timeout": {
                      "type": "number",
                      "title": "P2* Enhanced Timeout (seconds)",
                      "description": "Enhanced P2 timeout for long operations",
                      "minimum": 1.0,
                      "maximum": 60.0,
                      "default": 5.0,
                      "ui:help": "Extended timeout for flash/programming operations"
                    }
                  }
                }
              ]
            }
          }
        }
      ]
    }
  }
}
